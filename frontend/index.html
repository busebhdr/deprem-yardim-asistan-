<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deprem HazÄ±rlÄ±k Sistemi</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .tabs {
            margin-bottom: 20px;
        }
        .tab-button {
            padding: 10px 20px;
            margin-right: 5px;
            cursor: pointer;
            background-color: #ddd;
            border: none;
            border-radius: 4px 4px 0 0;
        }
        .tab-button.active {
            background-color: #4CAF50;
            color: white;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .category {
            background: #f8f8f8;
            margin: 10px 0;
            padding: 15px;
            border-radius: 5px;
        }
        .category h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        .product-checkbox {
            display: flex;
            align-items: center;
            margin: 5px 0;
            width: 45%;
        }
        .quantity {
            width: 60px;
            margin-left: 10px;
            padding: 4px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .form-group {
            margin: 20px 0;
        }
        select, input[type="text"], textarea {
            padding: 8px;
            margin: 5px 0;
            width: 100%;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        #emergency-btn {
            background-color: #f44336;
            font-weight: bold;
        }
        .success {
            background-color: #e8f5e9;
            color: #2e7d32;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .error {
            background-color: #ffebee;
            color: #c62828;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .ai-powered {
            background: #e3f2fd;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            text-align: center;
        }
        .ai-processing {
            color: blue;
            text-align: center;
            padding: 10px;
        }
        .spinner {
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 10px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .city-summary {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        #map {
            height: 400px;
            width: 100%;
            margin: 20px 0;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸšï¸ Deprem HazÄ±rlÄ±k Sistemi</h1>
        
        <div class="ai-powered">
            ğŸ¤– Google Gemini AI ile gÃ¼Ã§lendirildi
        </div>
        
        <div class="tabs">
            <button class="tab-button active" onclick="openTab('donate')">ğŸ YardÄ±m Verebilirim</button>
            <button class="tab-button" onclick="openTab('need')">ğŸ†˜ YardÄ±m Ä°stiyorum</button>
            <button class="tab-button" onclick="openTab('logistics')">Lojistik KayÄ±t</button>
            <button class="tab-button" onclick="openTab('market')">ğŸª Market/Bakkal KaydÄ±</button>
            <button class="tab-button" onclick="openTab('check')">Stok Durumu</button>
            <button class="tab-button" onclick="openTab('ai-dashboard')">ğŸ¤– AI Dashboard</button>
            <button class="tab-button" onclick="openTab('emergency')">ğŸš¨ ACÄ°L DURUM</button>
        </div>

        <!-- BaÄŸÄ±ÅŸ KayÄ±t -->
        <div id="donate" class="tab-content active">
            <h2>Deprem Ã–ncesi BaÄŸÄ±ÅŸ KaydÄ±</h2>
            
            <div class="form-group">
                <label>AdÄ±nÄ±z/FirmanÄ±z:</label>
                <input type="text" id="donorName" placeholder="Ä°sminiz">
            </div>
            
            <div class="form-group">
                <label>Konumunuz:</label>
                <select id="donorCity">
                    <option value="">Åehir seÃ§iniz...</option>
                    <option value="Ä°stanbul">Ä°stanbul</option>
                    <option value="Ä°zmir">Ä°zmir</option>
                    <option value="Ankara">Ankara</option>
                    <option value="Adana">Adana</option>
                    <option value="Antalya">Antalya</option>
                    <option value="Bursa">Bursa</option>
                    <option value="Gaziantep">Gaziantep</option>
                    <option value="Konya">Konya</option>
                    <option value="Samsun">Samsun</option>
                    <option value="Kayseri">Kayseri</option>
                    <option value="Trabzon">Trabzon</option>
                    <option value="Denizli">Denizli</option>
                    <option value="DiyarbakÄ±r">DiyarbakÄ±r</option>
                    <option value="Mersin">Mersin</option>
                    <option value="EskiÅŸehir">EskiÅŸehir</option>
                    <option value="Malatya">Malatya</option>
                    <option value="KahramanmaraÅŸ">KahramanmaraÅŸ</option>
                </select>
            </div>

            <h3>BaÄŸÄ±ÅŸlayabileceÄŸiniz Malzemeler</h3>
            
            <div class="category">
                <h3>ğŸš¨ 1. Hayatta Kalma ve GÄ±da</h3>
                <div style="display: flex; flex-wrap: wrap;">
                    <div class="product-checkbox">
                        <input type="checkbox" name="product" value="Ä°Ã§me suyu"> Ä°Ã§me suyu
                        <input type="number" class="quantity" min="1" value="0" disabled>
                    </div>
                    <div class="product-checkbox">
                        <input type="checkbox" name="product" value="Konserve"> Konserve
                        <input type="number" class="quantity" min="1" value="0" disabled>
                    </div>
                    <div class="product-checkbox">
                        <input type="checkbox" name="product" value="BiskÃ¼vi"> BiskÃ¼vi
                        <input type="number" class="quantity" min="1" value="0" disabled>
                    </div>
                    <div class="product-checkbox">
                        <input type="checkbox" name="product" value="KuruyemiÅŸ"> KuruyemiÅŸ
                        <input type="number" class="quantity" min="1" value="0" disabled>
                    </div>
                    <div class="product-checkbox">
                        <input type="checkbox" name="product" value="Bebek mamasÄ±"> Bebek mamasÄ±
                        <input type="number" class="quantity" min="1" value="0" disabled>
                    </div>
                    <div class="product-checkbox">
                        <input type="checkbox" name="product" value="Biberon"> Biberon
                        <input type="number" class="quantity" min="1" value="0" disabled>
                    </div>
                </div>
            </div>
            <div class="category">
                <h3>ğŸ›¡ï¸ 2. BarÄ±nma ve IsÄ±nma</h3>
                <div style="display: flex; flex-wrap: wrap;">
                    <div class="product-checkbox">
                        <input type="checkbox" name="product" value="Ã‡adÄ±r"> Ã‡adÄ±r
                        <input type="number" class="quantity" min="1" value="0" disabled>
                    </div>
                    <div class="product-checkbox">
                        <input type="checkbox" name="product" value="Battaniye"> Battaniye
                        <input type="number" class="quantity" min="1" value="0" disabled>
                    </div>
                    <div class="product-checkbox">
                        <input type="checkbox" name="product" value="Uyku tulumu"> Uyku tulumu
                        <input type="number" class="quantity" min="1" value="0" disabled>
                    </div>
                    <div class="product-checkbox">
                        <input type="checkbox" name="product" value="IsÄ±tÄ±cÄ±"> IsÄ±tÄ±cÄ±
                        <input type="number" class="quantity" min="1" value="0" disabled>
                    </div>
                    <div class="product-checkbox">
                        <input type="checkbox" name="product" value="Mont"> Mont
                        <input type="number" class="quantity" min="1" value="0" disabled>
                    </div>
                    <div class="product-checkbox">
                        <input type="checkbox" name="product" value="Ã‡orap"> Ã‡orap
                        <input type="number" class="quantity" min="1" value="0" disabled>
                    </div>
                    <div class="product-checkbox">
                        <input type="checkbox" name="product" value="Bere ve Eldiven"> Bere ve Eldiven
                        <input type="number" class="quantity" min="1" value="0" disabled>
                    </div>
                </div>
            </div>

            <div class="category">
                <h3>ğŸ§¼ 3. Hijyen ve SaÄŸlÄ±k</h3>
                <div style="display: flex; flex-wrap: wrap;">
                    <div class="product-checkbox">
                        <input type="checkbox" name="product" value="Islak mendil"> Islak mendil
                        <input type="number" class="quantity" min="1" value="0" disabled>
                    </div>
                    <div class="product-checkbox">
                        <input type="checkbox" name="product" value="Dezenfektan"> El dezenfektanÄ±
                        <input type="number" class="quantity" min="1" value="0" disabled>
                    </div>
                    <div class="product-checkbox">
                        <input type="checkbox" name="product" value="Sabun"> Sabun
                        <input type="number" class="quantity" min="1" value="0" disabled>
                    </div>
                    <div class="product-checkbox">
                        <input type="checkbox" name="product" value="Tuvalet kaÄŸÄ±dÄ±"> Tuvalet kaÄŸÄ±dÄ±
                        <input type="number" class="quantity" min="1" value="0" disabled>
                    </div>
                    <div class="product-checkbox">
                        <input type="checkbox" name="product" value="DiÅŸ fÄ±rÃ§asÄ±"> DiÅŸ fÄ±rÃ§asÄ±
                        <input type="number" class="quantity" min="1" value="0" disabled>
                    </div>
                    
                    <div class="product-checkbox">
                        <input type="checkbox" name="product" value="DiÅŸ macunu"> DiÅŸ macunu
                        <input type="number" class="quantity" min="1" value="0" disabled>
                    </div>
                    <div class="product-checkbox">
                        <input type="checkbox" name="product" value="Bebek bezi"> Bebek bezi
                        <input type="number" class="quantity" min="1" value="0" disabled>
                    </div>
                    <div class="product-checkbox">
                        <input type="checkbox" name="product" value="Ä°lk yardÄ±m Ã§antasÄ±"> Ä°lk yardÄ±m Ã§antasÄ±
                        <input type="number" class="quantity" min="1" value="0" disabled>
                    </div>
                </div>
            </div>
            <div class="category">
                <h3>ğŸ”‹ 4. AydÄ±nlatma ve Ä°letiÅŸim</h3>
                <div style="display: flex; flex-wrap: wrap;">
                    <div class="product-checkbox">
                        <input type="checkbox" name="product" value="El feneri"> El feneri
                        <input type="number" class="quantity" min="1" value="0" disabled>
                    </div>
                    <div class="product-checkbox">
                        <input type="checkbox" name="product" value="Yedek pil"> Yedek pil
                        <input type="number" class="quantity" min="1" value="0" disabled>
                    </div>
                    <div class="product-checkbox">
                        <input type="checkbox" name="product" value="Powerbank"> Powerbank
                        <input type="number" class="quantity" min="1" value="0" disabled>
                    </div>
                    <div class="product-checkbox">
                        <input type="checkbox" name="product" value="Radyo"> Radyo
                        <input type="number" class="quantity" min="1" value="0" disabled>
                    </div>
                    <div class="product-checkbox">
                        <input type="checkbox" name="product" value="Åarj kablosu"> Åarj kablosu
                        <input type="number" class="quantity" min="1" value="0" disabled>
                    </div>
                </div>
            </div>

            <button onclick="submitDonation()">BAÄIÅ KAYDINI TAMAMLA</button>
            <div id="donationResult"></div>
        </div>

        <!-- YardÄ±m Talep Formu -->
        <div id="need" class="tab-content">
            <h2>ğŸ†˜ YardÄ±m Talep Formu</h2>
            <p><strong>Ä°htiyaÃ§larÄ±nÄ±zÄ± belirtin, size en yakÄ±n yardÄ±mÄ± bulalÄ±m.</strong></p>
            
            <div class="form-group">
                <label>AdÄ±nÄ±z/Kurumunuz:</label>
                <input type="text" id="needName" placeholder="Ä°sminiz">
            </div>
            
            <div class="form-group">
                <label>Konumunuz:</label>
                <select id="needCity">
                    <option value="">Åehir seÃ§iniz...</option>
                    <option value="Ä°stanbul">Ä°stanbul</option>
                    <option value="Ä°zmir">Ä°zmir</option>
                    <option value="Ankara">Ankara</option>
                    <option value="Adana">Adana</option>
                    <option value="Antalya">Antalya</option>
                    <option value="Bursa">Bursa</option>
                    <option value="Gaziantep">Gaziantep</option>
                    <option value="Konya">Konya</option>
                    <option value="Samsun">Samsun</option>
                    <option value="Kayseri">Kayseri</option>
                    <option value="Trabzon">Trabzon</option>
                    <option value="Denizli">Denizli</option>
                    <option value="DiyarbakÄ±r">DiyarbakÄ±r</option>
                    <option value="Mersin">Mersin</option>
                    <option value="EskiÅŸehir">EskiÅŸehir</option>
                    <option value="Malatya">Malatya</option>
                    <option value="KahramanmaraÅŸ">KahramanmaraÅŸ</option>
                </select>
            </div>

            <div class="form-group">
                <label>Ä°htiyaÃ§ Durumunuzu YazÄ±n:</label>
                <textarea id="needText" rows="4" placeholder="Ã–rn: Acilen su ve battaniye lazÄ±m, Ã§ocuklarÄ±n Ã¼ÅŸÃ¼yor"></textarea>
            </div>

            <div class="form-group">
                <label>Aciliyet Durumu:</label>
                <select id="urgencyLevel">
                    <option value="dÃ¼ÅŸÃ¼k">DÃ¼ÅŸÃ¼k (24 saat iÃ§inde)</option>
                    <option value="orta">Orta (12 saat iÃ§inde)</option>
                    <option value="yÃ¼ksek">YÃ¼ksek (6 saat iÃ§inde)</option>
                    <option value="acil">Acil (Hemen!)</option>
                </select>
            </div>

            <button onclick="submitNeed()">YARDIM TALEBÄ°NÄ° GÃ–NDER</button>
            <div id="needResult"></div>
        </div>

        <!-- Lojistik KayÄ±t -->
        <div id="logistics" class="tab-content">
            <h2>Lojistik Firma/TÄ±r KaydÄ±</h2>
            
            <div class="form-group">
                <label>Firma/KiÅŸi AdÄ±:</label>
                <input type="text" id="logisticsName" placeholder="Firma adÄ±nÄ±z">
            </div>
            
            <div class="form-group">
                <label>Ãœs Konumunuz:</label>
                <select id="logisticsCity">
                    <option value="">Åehir seÃ§iniz...</option>
                    <option value="Ä°stanbul">Ä°stanbul</option>
                    <option value="Ä°zmir">Ä°zmir</option>
                    <option value="Ankara">Ankara</option>
                    <option value="Adana">Adana</option>
                    <option value="Antalya">Antalya</option>
                    <option value="Bursa">Bursa</option>
                    <option value="Gaziantep">Gaziantep</option>
                    <option value="Konya">Konya</option>
                    <option value="Samsun">Samsun</option>
                    <option value="Kayseri">Kayseri</option>
                    <option value="Trabzon">Trabzon</option>
                    <option value="Denizli">Denizli</option>
                    <option value="DiyarbakÄ±r">DiyarbakÄ±r</option>
                    <option value="Mersin">Mersin</option>
                    <option value="EskiÅŸehir">EskiÅŸehir</option>
                    <option value="Malatya">Malatya</option>
                    <option value="KahramanmaraÅŸ">KahramanmaraÅŸ</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>SunabileceÄŸiniz TÄ±r SayÄ±sÄ±:</label>
                <input type="number" id="truckCount" min="1" max="50" value="1">
            </div>
            
            <button onclick="registerLogistics()">LOJÄ°STÄ°K KAYDINI TAMAMLA</button>
            <div id="logisticsResult"></div>
        </div>
        
        <!-- Market KayÄ±t sekmesi -->
        <div id="market" class="tab-content">
            <h2>ğŸª Market/Bakkal KaydÄ±</h2>
            
            <div class="form-group">
                <label>Market/Firma AdÄ±:</label>
                <input type="text" id="marketName" placeholder="Marketinizin adÄ±">
            </div>
            
            <div class="form-group">
                <label>Konumunuz:</label>
                <select id="marketCity">
                    <option value="">Åehir seÃ§iniz...</option>
                    <option value="Ä°stanbul">Ä°stanbul</option>
                    <option value="Ä°zmir">Ä°zmir</option>
                    <option value="Ankara">Ankara</option>
                    <option value="Adana">Adana</option>
                    <option value="Antalya">Antalya</option>
                    <option value="Bursa">Bursa</option>
                    <option value="Gaziantep">Gaziantep</option>
                    <option value="Konya">Konya</option>
                    <option value="Samsun">Samsun</option>
                    <option value="Kayseri">Kayseri</option>
                    <option value="Trabzon">Trabzon</option>
                    <option value="Denizli">Denizli</option>
                    <option value="DiyarbakÄ±r">DiyarbakÄ±r</option>
                    <option value="Mersin">Mersin</option>
                    <option value="EskiÅŸehir">EskiÅŸehir</option>
                    <option value="Malatya">Malatya</option>
                    <option value="KahramanmaraÅŸ">KahramanmaraÅŸ</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>BaÄŸÄ±ÅŸlayabileceÄŸiniz Malzemeler:</label>
                <textarea id="marketSupplies" rows="4" placeholder="Ã–rn: 100 adet konserve, 50 ÅŸiÅŸe su vb."></textarea>
            </div>
            
            <button onclick="registerMarket()">MARKET KAYDINI TAMAMLA</button>
            <div id="marketResult"></div>
        </div>

        <!-- Stok Durumu -->
        <div id="check" class="tab-content">
            <h2>Mevcut Stok Durumu</h2>
            <button onclick="checkStock()">STOK DURUMUNU GÃ–RÃœNTÃœLE</button>
            
            <!-- Harita -->
            <div id="map"></div>
            
            <div id="stockResult"></div>
        </div>
        <!-- AI Dashboard -->
        <div id="ai-dashboard" class="tab-content">
            <h2>ğŸ¤– Yapay Zeka Analiz Merkezi</h2>
            
            <div class="ai-powered" style="text-align: left; padding: 20px;">
                <h3>Sistem Metrikleri</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div style="background: #e8f5e9; padding: 15px; border-radius: 5px;">
                        <h4>AI Analiz SayÄ±sÄ±</h4>
                        <h2 id="aiAnalysisCount">0</h2>
                    </div>
                    <div style="background: #e3f2fd; padding: 15px; border-radius: 5px;">
                        <h4>BaÅŸarÄ±lÄ± EÅŸleÅŸtirme</h4>
                        <h2 id="aiMatchCount">0</h2>
                    </div>
                    <div style="background: #fff3e0; padding: 15px; border-radius: 5px;">
                        <h4>AI GÃ¼ven OranÄ±</h4>
                        <h2 id="aiAccuracy">98%</h2>
                    </div>
                </div>
            </div>
            
            <div style="margin-top: 20px;">
                <h3>Son AI Ã–ncelik Analizleri</h3>
                <div id="recentAIAnalysis"></div>
            </div>
            
            <div style="margin-top: 20px;">
                <h3>AI EÅŸleÅŸtirme Demo</h3>

                <select id="demoCity">
                    <option value="Ä°stanbul">Ä°stanbul</option>
                    <option value="Ä°zmir">Ä°zmir</option>
                    <option value="Ankara">Ankara</option>
                    <option value="Adana">Adana</option>
                    <option value="Antalya">Antalya</option>
                    <option value="Bursa">Bursa</option>
                    <option value="Gaziantep">Gaziantep</option>
                    <option value="Konya">Konya</option>
                    <option value="Samsun">Samsun</option>
                    <option value="Kayseri">Kayseri</option>
                    <option value="Trabzon">Trabzon</option>
                    <option value="Denizli">Denizli</option>
                    <option value="DiyarbakÄ±r">DiyarbakÄ±r</option>
                    <option value="Mersin">Mersin</option>
                    <option value="EskiÅŸehir">EskiÅŸehir</option>
                    <option value="Malatya">Malatya</option>
                    <option value="KahramanmaraÅŸ">KahramanmaraÅŸ</option>
                </select>
                <select id="demoProduct">
                    <option value="Battaniye">Battaniye</option>
                    <option value="Ã‡adÄ±r">Ã‡adÄ±r</option>
                    <option value="Su">Su</option>
                </select>
                <button onclick="runAIDemo()">AI DEMOSÄ°NÄ° Ã‡ALIÅTIR</button>
                <div id="aiDemoResult"></div>

                <div style="margin-top: 30px;">
                    <h3>ğŸ”® AI Risk Analizi</h3>
                    <button onclick="runRiskAnalysis()" style="background: #9c27b0;">AI Analiz Ã‡alÄ±ÅŸtÄ±r</button>
                    <div id="riskAnalysisResult"></div>
                </div>
            </div>
        </div>

        <!-- Acil Durum -->
        <div id="emergency" class="tab-content">
            <h2>ğŸš¨ DEPREM ACÄ°L DURUM ğŸš¨</h2>
            <p>Deprem gerÃ§ekleÅŸti! TÃ¼m baÄŸÄ±ÅŸÃ§Ä±lara bildirim gÃ¶nderilecek.</p>
            
            <div class="form-group">
                <label>Deprem Olan Åehir:</label>
                <select id="disasterCity">
                    <option value="">Åehir seÃ§iniz...</option>
                    <option value="Ä°stanbul">Ä°stanbul</option>
                    <option value="Ä°zmir">Ä°zmir</option>
                    <option value="Ankara">Ankara</option>
                    <option value="Adana">Adana</option>
                    <option value="Antalya">Antalya</option>
                    <option value="Bursa">Bursa</option>
                    <option value="Gaziantep">Gaziantep</option>
                    <option value="Konya">Konya</option>
                    <option value="Samsun">Samsun</option>
                    <option value="Kayseri">Kayseri</option>
                    <option value="Trabzon">Trabzon</option>
                    <option value="Denizli">Denizli</option>
                    <option value="DiyarbakÄ±r">DiyarbakÄ±r</option>
                    <option value="Mersin">Mersin</option>
                    <option value="EskiÅŸehir">EskiÅŸehir</option>
                    <option value="Malatya">Malatya</option>
                    <option value="KahramanmaraÅŸ">KahramanmaraÅŸ</option>
                </select>
            </div>
            
            <button id="emergency-btn" onclick="activateEmergency()">ACÄ°L DURUMU AKTÄ°VE ET!</button>
            <div id="emergencyStatus"></div>
            <button onclick="resetDisasterStatus()" style="background: #607d8b; margin-top: 20px;">
                Deprem Durumunu SÄ±fÄ±rla
            </button>
        </div>
    </div>

    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</body>
</html>
<script>
    const API_URL = 'http://localhost:8000';
    let mapInstance = null;

    // Harita baÅŸlatma fonksiyonu
    function initMap() {
        if (!mapInstance) {
            mapInstance = L.map('map').setView([39.0, 35.0], 5);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: 'Â© OpenStreetMap contributors'
            }).addTo(mapInstance);
        }
        return mapInstance;
    }

    // Åehirlerin koordinatlarÄ±
    const cityCoordinates = {
        'Ä°stanbul': [41.0082, 28.9784],
        'Ankara': [39.9334, 32.8597],
        'Ä°zmir': [38.4192, 27.1287],
        'Bursa': [40.1826, 29.0665],
        'Trabzon': [41.0027, 39.7168],
        'Samsun': [41.2928, 36.3313],
        'Adana': [37.0000, 35.3213],
        'Antalya': [36.8969, 30.7133],
        'Konya': [37.8667, 32.4833],
        'Gaziantep': [37.0662, 37.3833],
        'Kayseri': [38.7312, 35.4787],
        'Denizli': [37.7833, 29.0833],
        'DiyarbakÄ±r': [37.9144, 40.2306],
        'Mersin': [36.8000, 34.6333],
        'EskiÅŸehir': [39.7667, 30.5250],
        'Malatya': [38.3552, 38.3095],
        'KahramanmaraÅŸ': [37.5750, 37.2100]
    };

    // Toplanma noktalarÄ±
    const collectionPoints = {
        'Ä°stanbul': {
            points: ['Taksim MeydanÄ±', 'Sultanahmet MeydanÄ±', 'BeyazÄ±t MeydanÄ±'],
            coordinates: [[41.0367, 28.9850], [41.0082, 28.9784], [41.0103, 28.9638]]
        },
        'Ankara': {
            points: ['Ulus MeydanÄ±', 'KÄ±zÄ±lay MeydanÄ±', 'TunalÄ± Caddesi'],
            coordinates: [[39.9390, 32.8551], [39.9208, 32.8541], [39.9127, 32.8360]]
        },
        'Ä°zmir': {
            points: ['Konak MeydanÄ±', 'Cumhuriyet MeydanÄ±', 'Alsancak'],
            coordinates: [[38.4237, 27.1428], [38.4189, 27.1287], [38.4392, 27.1472]]
        },
        'Bursa': {
            points: ['Heykel MeydanÄ±', 'Kent MeydanÄ±', 'Ulucami Park'],
            coordinates: [[40.1826, 29.0665], [40.1956, 29.0736], [40.1823, 29.0639]]
        },
        'Adana': {
            points: ['Merkez Park', 'AtatÃ¼rk ParkÄ±', 'BÃ¼yÃ¼k Saat'],
            coordinates: [[37.0000, 35.3213], [36.9921, 35.3095], [36.9917, 35.3308]]
        },
        'Antalya': {
            points: ['Cumhuriyet MeydanÄ±', 'KaraalioÄŸlu ParkÄ±', 'Yivli Minare ParkÄ±'],
            coordinates: [[36.8969, 30.7133], [36.8837, 30.7025], [36.8843, 30.7042]]
        },
        'Konya': {
            points: ['Mevlana MeydanÄ±', 'Alaeddin Tepesi', 'Karatay Park'],
            coordinates: [[37.8667, 32.4833], [37.8713, 32.4889], [37.8612, 32.4756]]
        },
        'Gaziantep': {
            points: ['Kale ParkÄ±', 'Inci Park', 'DÃ¼lÃ¼k Park'],
            coordinates: [[37.0662, 37.3833], [37.0651, 37.3775], [37.0745, 37.3952]]
        },
        'ÅanlÄ±urfa': {
            points: ['BalÄ±klÄ±gÃ¶l ParkÄ±', 'GÃ¼llÃ¼bahÃ§e Park', 'Abgar Park'],
            coordinates: [[37.1492, 38.7942], [37.1583, 38.7885], [37.1476, 38.7929]]
        },
        'Kocaeli': {
            points: ['Ä°zmit Saat Kulesi', 'Yeni Pazar Merkez', 'Kartepe Park'],
            coordinates: [[40.7654, 29.9406], [40.7612, 29.9385], [40.7698, 29.9532]]
        },
        'Mersin': {
            points: ['Ä°Ã§el KÃ¼ltÃ¼r Park', 'Mersin Marina', 'Sosyal Park'],
            coordinates: [[36.8000, 34.6333], [36.7950, 34.6400], [36.8050, 34.6300]]
        },
        'DiyarbakÄ±r': {
            points: ['Ofis Ä°stasyonu', 'Dicle ParkÄ±', 'DaÄŸkapÄ± MeydanÄ±'],
            coordinates: [[37.9144, 40.2306], [37.9100, 40.2250], [37.9167, 40.2389]]
        },
        'Hatay': {
            points: ['Ulu Cami ParkÄ±', 'ASO Park', 'SÃ¼merler ParkÄ±'],
            coordinates: [[36.4018, 36.3498], [36.4056, 36.3450], [36.3982, 36.3542]]
        },
        'Manisa': {
            points: ['Mesir MeydanÄ±', 'Spil Park', 'Mesir Park'],
            coordinates: [[38.6191, 27.4289], [38.6234, 27.4312], [38.6156, 27.4278]]
        },
        'Samsun': {
            points: ['Cumhuriyet MeydanÄ±', 'AtatÃ¼rk MeydanÄ±', 'Ä°lkadÄ±m ParkÄ±'],
            coordinates: [[41.2928, 36.3313], [41.2975, 36.3361], [41.2845, 36.3225]]
        },
        'Sakarya': {
            points: ['Adliye ParkÄ±', 'Kent MeydanÄ±', 'Kartepe Merkez'],
            coordinates: [[40.7864, 30.4031], [40.7823, 30.4012], [40.7900, 30.4089]]
        },
        'KahramanmaraÅŸ': {
            points: ['Elbistan Park', 'Åehir ParkÄ±', 'GÃ¶ynÃ¼k Park'],
            coordinates: [[37.5783, 37.2097], [37.5756, 37.2045], [37.5812, 37.2134]]
        },
        'Van': {
            points: ['Cumhuriyet MeydanÄ±', 'Van Kalesi Park', 'Merkez Park'],
            coordinates: [[38.4891, 43.4089], [38.4967, 43.3978], [38.4856, 43.4112]]
        },
        'Denizli': {
            points: ['AtatÃ¼rk Park', 'YÃ¼zbaÅŸÄ± Park', 'DelikliÃ§Ä±nar Park'],
            coordinates: [[37.7747, 29.0875], [37.7723, 29.0856], [37.7789, 29.0912]]
        },
        'EskiÅŸehir': {
            points: ['Haller GenÃ§lik Merkezi', 'Kent Park', 'Sazova ParkÄ±'],
            coordinates: [[39.7667, 30.5250], [39.7700, 30.5280], [39.7630, 30.5220]]
        },
        'Malatya': {
            points: ['Kernek MeydanÄ±', 'Ä°nÃ¶nÃ¼ ParkÄ±', 'Vilayet MeydanÄ±'],
            coordinates: [[38.3552, 38.3095], [38.3520, 38.3150], [38.3580, 38.3050]]
        }
    };

    // Checkbox deÄŸiÅŸtiÄŸinde miktar inputunu aktif/pasif yap
    document.addEventListener('DOMContentLoaded', function() {
        const checkboxes = document.querySelectorAll('input[name="product"]');
        checkboxes.forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const quantityInput = this.parentElement.querySelector('.quantity');
                quantityInput.disabled = !this.checked;
                if (!this.checked) quantityInput.value = 0;
            });
        });
    });

    function openTab(tabName) {
        var i, tabcontent, tabbuttons;
        tabcontent = document.getElementsByClassName("tab-content");
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].classList.remove("active");
        }
        tabbuttons = document.getElementsByClassName("tab-button");
        for (i = 0; i < tabbuttons.length; i++) {
            tabbuttons[i].classList.remove("active");
        }
        document.getElementById(tabName).classList.add("active");
        event.currentTarget.classList.add("active");
    }

    async function submitDonation() {
        const name = document.getElementById('donorName').value;
        const city = document.getElementById('donorCity').value;
        const checkboxes = document.getElementsByName('product');
        const selectedProducts = [];
        
        checkboxes.forEach(checkbox => {
            if (checkbox.checked) {
                const quantity = checkbox.parentElement.querySelector('.quantity').value;
                selectedProducts.push(`${checkbox.value}: ${quantity} adet`);
            }
        });

        if (!name || !city || selectedProducts.length === 0) {
            document.getElementById('donationResult').className = 'error';
            document.getElementById('donationResult').textContent = 'LÃ¼tfen tÃ¼m bilgileri doldurun!';
            return;
        }

        const productText = selectedProducts.join(', ');
        const fullText = `${productText} malzemelerini baÄŸÄ±ÅŸlayabilirim. Konumum: ${city}`;

        // AI processing gÃ¶ster
        const resultDiv = document.getElementById('donationResult');
        resultDiv.innerHTML = `
            <div class="ai-processing">
                ğŸ¤– Gemini AI Analiz YapÄ±yor...
                <div class="spinner"></div>
            </div>
        `;

        try {
            const response = await fetch(`${API_URL}/submit-entry`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ text: fullText, name })
            });

            const data = await response.json();
            resultDiv.className = 'success';
            resultDiv.innerHTML = `
                âœ… BaÄŸÄ±ÅŸÄ±nÄ±z kaydedildi! ID: ${data.id}
                <div class="ai-powered">
                    ğŸ§  Gemini AI ile analiz edildi
                </div>
                <div style="margin-top: 15px; padding: 10px; background: #e8f5e9;">
                    <h4>ğŸ—ºï¸ ${city} iÃ§in BaÄŸÄ±ÅŸ BÄ±rakma NoktalarÄ±:</h4>
                    <ul>
                        ${collectionPoints[city]?.points.map(point => 
                            `<li>ğŸ“ ${point}</li>`
                        ).join('') || '<li>Bu ÅŸehir iÃ§in henÃ¼z toplanma noktasÄ± belirlenmedi.</li>'}
                    </ul>
                    <p><strong>LÃ¼tfen malzemelerinizi bu noktalara bÄ±rakÄ±n.</strong></p>
                </div>
            `;
            
            // Formu temizle
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
                checkbox.parentElement.querySelector('.quantity').disabled = true;
                checkbox.parentElement.querySelector('.quantity').value = 0;
            });
            document.getElementById('donorName').value = '';
            document.getElementById('donorCity').value = '';
        } catch (error) {
            resultDiv.className = 'error';
            resultDiv.textContent = 'Hata: ' + error.message;
        }
    }

    async function submitNeed() {
        const city = document.getElementById('needCity').value;
        const resultDiv = document.getElementById('needResult');
        
        // Ã–nce deprem olan ÅŸehir olup olmadÄ±ÄŸÄ±nÄ± kontrol et
        const currentDisasterCity = sessionStorage.getItem('disasterCity');
        
        if (!currentDisasterCity) {
            resultDiv.className = 'error';
            resultDiv.textContent = 'Åu anda aktif bir deprem bÃ¶lgesi yoktur. Sadece deprem olan ÅŸehirdeki kullanÄ±cÄ±lar yardÄ±m talep edebilir.';
            return;
        }
        
        if (city !== currentDisasterCity) {
            resultDiv.className = 'error';
            resultDiv.textContent = `YardÄ±m talebi sadece ${currentDisasterCity} ÅŸehrindeki kullanÄ±cÄ±lar iÃ§in aÃ§Ä±ktÄ±r.`;
            return;
        }
        
        const name = document.getElementById('needName').value;
        const needText = document.getElementById('needText').value;
        const urgency = document.getElementById('urgencyLevel').value;
        
        if (!name || !city || !needText) {
            resultDiv.className = 'error';
            resultDiv.textContent = 'LÃ¼tfen tÃ¼m bilgileri doldurun!';
            return;
        }
        
        const fullText = `${needText}. Konum: ${city}. Aciliyet: ${urgency}`;

        // AI processing gÃ¶ster
        resultDiv.innerHTML = `
            <div class="ai-processing">
                ğŸ¤– Gemini AI Ä°htiyacÄ±nÄ±zÄ± Analiz Ediyor...
                <div class="spinner"></div>
            </div>
        `;

        try {
            const response = await fetch(`${API_URL}/submit-entry`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ text: fullText, name })
            });

            const data = await response.json();
            resultDiv.className = 'success';
            resultDiv.innerHTML = `
                âœ… Ä°htiyacÄ±nÄ±z baÅŸarÄ±yla kaydedildi! ID: ${data.id}
                <div class="ai-powered">
                    ğŸ§  Gemini AI ile analiz edildi
                    <p>Size en yakÄ±n yardÄ±mlarÄ± arÄ±yoruz...</p>
                </div>
            `;
            
            // Form temizle
            document.getElementById('needName').value = '';
            document.getElementById('needCity').value = '';
            document.getElementById('needText').value = '';
            document.getElementById('urgencyLevel').value = 'dÃ¼ÅŸÃ¼k';
        } catch (error) {
            resultDiv.className = 'error';
            resultDiv.textContent = 'Hata: ' + error.message;
        }
    }

    async function registerLogistics() {
        const name = document.getElementById('logisticsName').value;
        const city = document.getElementById('logisticsCity').value;
        const truckCount = document.getElementById('truckCount').value;

        if (!name || !city || !truckCount) {
            document.getElementById('logisticsResult').className = 'error';
            document.getElementById('logisticsResult').textContent = 'LÃ¼tfen tÃ¼m bilgileri doldurun!';
            return;
        }

        const text = `Lojistik firmasÄ± olarak ${truckCount} tÄ±r sunabilirim. Konum: ${city}`;

        try {
            const response = await fetch(`${API_URL}/submit-entry`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ text, name })
            });

            const data = await response.json();
            document.getElementById('logisticsResult').className = 'success';
            document.getElementById('logisticsResult').innerHTML = `âœ… Lojistik kaydÄ±nÄ±z tamamlandÄ±! ID: ${data.id}`;
        } catch (error) {
            document.getElementById('logisticsResult').className = 'error';
            document.getElementById('logisticsResult').textContent = 'Hata: ' + error.message;
        }
    }

    async function registerMarket() {
        const name = document.getElementById('marketName').value;
        const city = document.getElementById('marketCity').value;
        const supplies = document.getElementById('marketSupplies').value;

        if (!name || !city || !supplies) {
            document.getElementById('marketResult').className = 'error';
            document.getElementById('marketResult').textContent = 'LÃ¼tfen tÃ¼m bilgileri doldurun!';
            return;
        }

        const text = `Market olarak ${supplies} malzemeleri saÄŸlayabilirim. Konum: ${city}`;

        try {
            const response = await fetch(`${API_URL}/submit-entry`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ text, name })
            });

            const data = await response.json();
            document.getElementById('marketResult').className = 'success';
            document.getElementById('marketResult').innerHTML = `âœ… Market kaydÄ±nÄ±z tamamlandÄ±! ID: ${data.id}`;
        } catch (error) {
            document.getElementById('marketResult').className = 'error';
            document.getElementById('marketResult').textContent = 'Hata: ' + error.message;
        }
    }

    async function checkStock() {
        const resultDiv = document.getElementById('stockResult');
        resultDiv.innerHTML = '<div class="ai-processing">ğŸ“Š Stok hesaplanÄ±yor...</div>';
        
        try {
            const response = await fetch(`${API_URL}/stock-summary`);
            const data = await response.json();
            
            // HaritayÄ± baÅŸlat
            const map = initMap();
            
            // Ã–nceki markerlarÄ± temizle
            map.eachLayer(layer => {
                if (layer instanceof L.Marker || layer instanceof L.Polyline) {
                    map.removeLayer(layer);
                }
            });
            
            let html = '<h3>Åehir BazlÄ± DetaylÄ± Stok Durumu:</h3>';
            
            Object.entries(data.stock_summary).forEach(([city, cityData]) => {
                // Haritaya marker ekle
                if (cityCoordinates[city]) {
                    const coords = cityCoordinates[city];
                    
                    // Ä°htiyaÃ§ ve arz listelerini ayÄ±r
                    let demandList = [];
                    let supplyList = [];
                    
                    cityData.entries.forEach(entry => {
                        if (entry.text.includes('Ä°htiyaÃ§') || entry.text.includes('lazÄ±m') || entry.text.includes('acil')) {
                            demandList.push(entry.text);
                        } else {
                            supplyList.push(entry.text);
                        }
                    });
                    
                    const marker = L.marker(coords).addTo(map);
                    marker.bindPopup(`
                        <b>${city}</b><br>
                        <b>ğŸ“¦ BaÄŸÄ±ÅŸlar:</b><br>
                        ${supplyList.slice(0,2).join('<br>') || 'Yok'}<br>
                        <b>ğŸš¨ Ä°htiyaÃ§lar:</b><br>
                        ${demandList.slice(0,2).join('<br>') || 'Yok'}<br>
                        <b>TÄ±r SayÄ±sÄ±:</b> ${cityData.trucks}
                    `);
                }
                
                html += `
                    <div class="city-summary">
                        <h4>${city}</h4>
                        <div style="margin-bottom: 10px; border-bottom: 1px solid #ddd; padding-bottom: 10px;">
                            <strong>ğŸ“¦ BaÄŸÄ±ÅŸlar:</strong>
                            <ul style="margin: 5px 0; color: green; list-style-type: none; padding-left: 20px;">
                `;
                
                // BaÄŸÄ±ÅŸ listeleri
                cityData.entries.forEach(entry => {
                    if (!entry.text.includes('Ä°htiyaÃ§') && !entry.text.includes('lazÄ±m') && !entry.text.includes('acil')) {
                        html += `<li>âœ… ${entry.name}: ${entry.text}</li>`;
                    }
                });
                
                html += `
                            </ul>
                        </div>
                        <div style="padding-top: 10px;">
                            <strong>ğŸš¨ Ä°htiyaÃ§lar:</strong>
                            <ul style="margin: 5px 0; color: red; list-style-type: none; padding-left: 20px;">
                `;
                
                // Ä°htiyaÃ§ listeleri
                cityData.entries.forEach(entry => {
                    if (entry.text.includes('Ä°htiyaÃ§') || entry.text.includes('lazÄ±m') || entry.text.includes('acil')) {
                        html += `<li>âŒ ${entry.name}: ${entry.text}</li>`;
                    }
                });
                
                html += `
                            </ul>
                        </div>
                        ${cityData.trucks > 0 ? `<p><strong>ğŸš› TÄ±r SayÄ±sÄ±:</strong> ${cityData.trucks}</p>` : ''}
                    </div>
                `;
            });
            
            resultDiv.innerHTML = html;

            // RotalarÄ± gÃ¶ster
            try {
                const routeResponse = await fetch(`${API_URL}/active-routes`);
                const routeData = await routeResponse.json();
                const currentDisasterCity = sessionStorage.getItem('disasterCity');
                
                // EÄŸer deprem aktif ise, sadece o ÅŸehre giden rotalarÄ± gÃ¶ster
                if (currentDisasterCity) {
                    // TÃ¼m ÅŸehirlerden deprem ÅŸehrine Ã§izgi Ã§ek
                    Object.keys(cityCoordinates).forEach(fromCity => {
                        if (fromCity !== currentDisasterCity && cityCoordinates[fromCity] && cityCoordinates[currentDisasterCity]) {
                            const latlngs = [cityCoordinates[fromCity], cityCoordinates[currentDisasterCity]];
                            const polyline = L.polyline(latlngs, {
                                color: 'red',  // Deprem rotasÄ± kÄ±rmÄ±zÄ±
                                weight: 3
                            }).addTo(map);
                            
                            polyline.bindPopup(`
                                <b>ğŸš› ${fromCity} â†’ ${currentDisasterCity}</b><br>
                                <b>DEPREM YARDIM ROTASI</b><br>
                                YardÄ±m malzemeleri gÃ¶nderilebilir
                            `);
                        }
                    });
                }
            } catch (error) {
                console.error('Rota yÃ¼klenirken hata:', error);
            }
        } catch (error) {
            resultDiv.className = 'error';
            resultDiv.textContent = 'Hata: ' + error.message;
        }
    }

    async function activateEmergency() {
        const city = document.getElementById('disasterCity').value;
        
        if (!city) {
            document.getElementById('emergencyStatus').className = 'error';
            document.getElementById('emergencyStatus').textContent = 'LÃ¼tfen deprem olan ÅŸehri seÃ§in!';
            return;
        }
        
        try {
            const response = await fetch(`${API_URL}/simulate-earthquake?konum=${encodeURIComponent(city)}`, {
                method: 'POST'
            });
            
            if (response.ok) {
                const data = await response.json();
                
                // Deprem olan ÅŸehri sessionStorage'a kaydet
                sessionStorage.setItem('disasterCity', city);
                
                // Deprem bÃ¶lgesindeki tÃ¼m kullanÄ±cÄ±lara bildirim sistemi
                alert(`Deprem UyarÄ±sÄ±: ${city} bÃ¶lgesinde deprem gerÃ§ekleÅŸti! Size Ã¶zel yardÄ±m sistemi aktifleÅŸtirildi.`);
                
                // HTML oluÅŸturma
                let html = `<h3>ğŸš¨ ${city} iÃ§in acil durum aktif!</h3>`;
                html += `<p>ğŸ•’ Zaman: ${data.timestamp}</p>`;
                html += `<h4>ğŸ“Š Mevcut Kaynaklar:</h4>`;
                
                Object.entries(data.available_resources).forEach(([key, value]) => {
                    html += `<p>â€¢ ${key}: ${value} adet</p>`;
                });
                
                html += `<h4>ğŸš› Lojistik Destek:</h4>`;
                if (data.logistics_support && data.logistics_support.length > 0) {
                    data.logistics_support.forEach(dispatch => {
                        html += `<p>âœˆï¸ ${dispatch.company} firmasÄ± ${dispatch.from}'dan ${dispatch.to}'a ${dispatch.product} gÃ¶nderiyor</p>`;
                        html += `<p>ğŸ“ VarÄ±ÅŸ zamanÄ±: ${dispatch.route.estimated_arrival}</p>`;
                    });
                }
                
                html += `<h4>ğŸ“¢ Durum GÃ¼ncellemeleri:</h4>`;
                data.status_updates.forEach(update => {
                    html += `<p>âœ… ${update}</p>`;
                });
                
                try {
                    // Bildirimleri getir
                    const notificationResponse = await fetch(`${API_URL}/get-notifications?konum=${city}`, {
                        method: 'POST'
                    });
                    const notificationData = await notificationResponse.json();
                    
                    html += `<h4>ğŸ“¬ GÃ¶nderilen Bildirimler:</h4>`;
                    if (notificationData.notifications && notificationData.notifications.length > 0) {
                        html += '<ul style="max-height: 200px; overflow-y: auto;">';
                        notificationData.notifications.forEach(notification => {
                            html += `<li>ğŸ“¤ ${notification.to} (${notification.city}): ${notification.message}</li>`;
                        });
                        html += '</ul>';
                    } else {
                        html += '<p>HenÃ¼z bildirim gÃ¶nderilmedi.</p>';
                    }
                } catch (error) {
                    console.error('Bildirim yÃ¼klenirken hata:', error);
                }
                
                document.getElementById('emergencyStatus').className = 'success';
                document.getElementById('emergencyStatus').innerHTML = html;
                
                // HaritayÄ± gÃ¼ncelle
                openTab('check');
            }
        } catch (error) {
            document.getElementById('emergencyStatus').className = 'error';
            document.getElementById('emergencyStatus').textContent = 'Hata: ' + error.message;
        }
    }

    function resetDisasterStatus() {
        sessionStorage.removeItem('disasterCity');
        document.getElementById('emergencyStatus').innerHTML = 
            '<div class="success">Deprem durumu sÄ±fÄ±rlandÄ±. Sistem normal moda dÃ¶ndÃ¼.</div>';
    }
    
    async function runAIDemo() {
        const city = document.getElementById('demoCity').value;
        const product = document.getElementById('demoProduct').value;
        const resultDiv = document.getElementById('aiDemoResult');
        
        resultDiv.innerHTML = '<div class="ai-processing">ğŸ¤– AI Analiz YapÄ±yor... <div class="spinner"></div></div>';
        
        try {
            const response = await fetch(`${API_URL}/ai-smart-matching?konum=${city}&urun_adi=${product}`, {
                method: 'POST'
            });
            const data = await response.json();
            
            resultDiv.innerHTML = `
                <div class="ai-powered" style="margin-top: 15px;">
                    <h4>ğŸ§  AI Analiz Sonucu</h4>
                    <p><strong>ğŸ¯ Ã–neri:</strong> ${data.ai_recommendation.recommended_city}</p>
                    <p><strong>ğŸ’¡ MantÄ±k:</strong> ${data.ai_recommendation.reason}</p>
                    <p><strong>ğŸ“ Mesafe:</strong> ${data.ai_recommendation.distance} km</p>
                    <p><strong>ğŸ“¦ Stok:</strong> ${data.ai_recommendation.available_amount} adet</p>
                    <div style="margin-top: 10px; padding: 10px; background: rgba(76, 175, 80, 0.1);">
                        <small>âœ¨ Gemini AI tarafÄ±ndan analiz edildi</small>
                    </div>
                </div>
            `;
            
            // AI metriklerini gÃ¼ncelle
            document.getElementById('aiAnalysisCount').textContent = 
                parseInt(document.getElementById('aiAnalysisCount').textContent) + 1;
            document.getElementById('aiMatchCount').textContent = 
                parseInt(document.getElementById('aiMatchCount').textContent) + 1;
                
        } catch (error) {
            resultDiv.className = 'error';
            resultDiv.textContent = 'Hata: ' + error.message;
        }
    }
    
    async function runRiskAnalysis() {
        const resultDiv = document.getElementById('riskAnalysisResult');
        resultDiv.innerHTML = '<div class="ai-processing">ğŸ¤– AI Risk Analizi YapÄ±yor... <div class="spinner"></div></div>';
        
        try {
            const response = await fetch(`${API_URL}/ai-risk-analysis`, {
                method: 'POST'
            });
            const data = await response.json();
            
            resultDiv.innerHTML = `
                <div class="ai-powered" style="margin-top: 15px;">
                    <h4>ğŸ¯ AI Analiz Sonucu</h4>
                    <div style="margin-bottom: 10px;">
                        <h5 style="color: #d32f2f;">âš ï¸ YÃ¼ksek Risk Åehirleri:</h5>
                        ${data.ai_analysis.high_risk.join(', ')}
                    </div>
                    <div style="margin-bottom: 10px;">
                        <h5 style="color: #f57c00;">ğŸ“‰ DÃ¼ÅŸÃ¼k Stok Åehirleri:</h5>
                        ${data.ai_analysis.low_supply.join(', ')}
                    </div>
                    <div style="margin-bottom: 10px;">
                         <h5 style="color: #0288d1;">ğŸ’¡ AI Ã–nerisi:</h5>
                          ${data.ai_analysis.recommendation}
                    </div>
                    <small style="color: #666;">Gemini AI tarafÄ±ndan analiz edildi</small>
                </div>
            `;
        } catch (error) {
            resultDiv.className = 'error';
        resultDiv.textContent = 'Hata: ' + error.message;
    }
}
    </script>
   
</body>
</html>